<!-- home.html -->
{% extends "base.html" %}
{% load static %}

{% block car %}
<div class="w-full text-black py-10 mt-20 relative">
    <div class="container mx-auto text-center">
        <h1 class="text-4xl font-bold mb-10">แนะนำรถเกี่ยวข้าว</h1>
    </div>
</div>

<div class="container-fluid w-full">
    <div class="bg-white p-6 rounded-lg shadow-2xl w-full flex flex-col md:flex-row justify-between items-center md:space-x-4 px-4">
        <h2 class="text-2xl font-bold text-gray-800">ปรเภทรถเกี่ยวนวดข้าว</h2>
        <div class="list-feature flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 items-center">
            <div class="list-checkbox flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4">
                <div class="form-checkbox flex items-center space-x-2">
                    <input id="type_sack" type="checkbox" value="แบบรองกระสอบ" class="form-checkbox h-4 w-4 text-blue-600">
                    <label for="type_sack" class="text-gray-700"><span class="checkbox"></span>แบบรองกระสอบ</label>
                </div>
                <div class="form-checkbox flex items-center space-x-2">
                    <input id="type_tank" type="checkbox" value="แบบถังอุ้ม" class="form-checkbox h-4 w-4 text-blue-600">
                    <label for="type_tank" class="text-gray-700"><span class="checkbox"></span>แบบถังอุ้ม</label>
                </div>
            </div>
            <select id="province_select" class="form-input p-2 border border-gray-300 rounded-lg shadow-sm">
                    <option value="">เลือกจังหวัด</option>
                    <option value="กรุงเทพมหานคร">กรุงเทพมหานคร</option>
                    <option value="กระบี่">กระบี่</option>
                    <option value="กาญจนบุรี">กาญจนบุรี</option>
                    <option value="กาฬสินธุ์">กาฬสินธุ์</option>
                    <option value="กำแพงเพชร">กำแพงเพชร</option>
                    <option value="ขอนแก่น">ขอนแก่น</option>
                    <option value="จันทบุรี">จันทบุรี</option>
                    <option value="ฉะเชิงเทรา">ฉะเชิงเทรา</option>
                    <option value="ชลบุรี">ชลบุรี</option>
                    <option value="ชัยนาท">ชัยนาท</option>
                    <option value="ชัยภูมิ">ชัยภูมิ</option>
                    <option value="ชุมพร">ชุมพร</option>
                    <option value="เชียงราย">เชียงราย</option>
                    <option value="เชียงใหม่">เชียงใหม่</option>
                    <option value="ตรัง">ตรัง</option>
                    <option value="ตราด">ตราด</option>
                    <option value="ตาก">ตาก</option>
                    <option value="นครนายก">นครนายก</option>
                    <option value="นครปฐม">นครปฐม</option>
                    <option value="นครพนม">นครพนม</option>
                    <option value="นครราชสีมา">นครราชสีมา</option>
                    <option value="นครศรีธรรมราช">นครศรีธรรมราช</option>
                    <option value="นครสวรรค์">นครสวรรค์</option>
                    <option value="นนทบุรี">นนทบุรี</option>
                    <option value="นราธิวาส">นราธิวาส</option>
                    <option value="น่าน">น่าน</option>
                    <option value="บึงกาฬ">บึงกาฬ</option>
                    <option value="บุรีรัมย์">บุรีรัมย์</option>
                    <option value="ปทุมธานี">ปทุมธานี</option>
                    <option value="ประจวบคีรีขันธ์">ประจวบคีรีขันธ์</option>
                    <option value="ปราจีนบุรี">ปราจีนบุรี</option>
                    <option value="ปัตตานี">ปัตตานี</option>
                    <option value="พระนครศรีอยุธยา">พระนครศรีอยุธยา</option>
                    <option value="พังงา">พังงา</option>
                    <option value="พัทลุง">พัทลุง</option>
                    <option value="พิจิตร">พิจิตร</option>
                    <option value="พิษณุโลก">พิษณุโลก</option>
                    <option value="เพชรบุรี">เพชรบุรี</option>
                    <option value="เพชรบูรณ์">เพชรบูรณ์</option>
                    <option value="แพร่">แพร่</option>
                    <option value="ภูเก็ต">ภูเก็ต</option>
                    <option value="มหาสารคาม">มหาสารคาม</option>
                    <option value="มุกดาหาร">มุกดาหาร</option>
                    <option value="แม่ฮ่องสอน">แม่ฮ่องสอน</option>
                    <option value="ยโสธร">ยโสธร</option>
                    <option value="ยะลา">ยะลา</option>
                    <option value="ร้อยเอ็ด">ร้อยเอ็ด</option>
                    <option value="ระนอง">ระนอง</option>
                    <option value="ระยอง">ระยอง</option>
                    <option value="ราชบุรี">ราชบุรี</option>
                    <option value="ลพบุรี">ลพบุรี</option>
                    <option value="ลำปาง">ลำปาง</option>
                    <option value="ลำพูน">ลำพูน</option>
                    <option value="เลย">เลย</option>
                    <option value="ศรีสะเกษ">ศรีสะเกษ</option>
                    <option value="สกลนคร">สกลนคร</option>
                    <option value="สงขลา">สงขลา</option>
                    <option value="สตูล">สตูล</option>
                    <option value="สมุทรปราการ">สมุทรปราการ</option>
                    <option value="สมุทรสงคราม">สมุทรสงคราม</option>
                    <option value="สมุทรสาคร">สมุทรสาคร</option>
                    <option value="สระแก้ว">สระแก้ว</option>
                    <option value="สระบุรี">สระบุรี</option>
                    <option value="สิงห์บุรี">สิงห์บุรี</option>
                    <option value="สุโขทัย">สุโขทัย</option>
                    <option value="สุพรรณบุรี">สุพรรณบุรี</option>
                    <option value="สุราษฎร์ธานี">สุราษฎร์ธานี</option>
                    <option value="สุรินทร์">สุรินทร์</option>
                    <option value="หนองคาย">หนองคาย</option>
                    <option value="หนองบัวลำภู">หนองบัวลำภู</option>
                    <option value="อ่างทอง">อ่างทอง</option>
                    <option value="อำนาจเจริญ">อำนาจเจริญ</option>
                    <option value="อุดรธานี">อุดรธานี</option>
                    <option value="อุตรดิตถ์">อุตรดิตถ์</option>
                    <option value="อุทัยธานี">อุทัยธานี</option>
                    <option value="อุบลราชธานี">อุบลราชธานี</option>
                </select>
                
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded-lg">ค้นหา</button>
            </form>
        </div>
    </div>
</div>

<section class="w-full py-10 bg-gray-200">
    <div class="container mx-auto px-4 py-8">
        <div class="mx-auto grid max-w-6xl grid-cols-1 gap-6 p-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3">
            {% for vehicle in vehicles %}
                <article class="rounded-xl bg-white p-3 shadow-lg hover:shadow-xl hover:transform hover:scale-95 duration-300"
                         data-province="{{ vehicle.province }}">
                    <div class="relative max-w-sm mx-auto bg-white rounded-lg shadow-md overflow-hidden">
                        <!-- Dropdown Button -->
                        <div class="absolute top-0 right-0 mt-2 mr-2">
                            <button onclick="toggleDropdown('{{ vehicle.id }}')" class="text-gray-700 focus:outline-none">
                                <i class="fa-solid fa-ellipsis-vertical"></i>
                            </button>
                            <!-- Dropdown Menu -->
                            <div id="dropdownMenu{{ vehicle.id }}" class="hidden absolute right-0 mt-8 w-48 bg-white rounded-md shadow-lg z-10">
                                <a href="{% url 'view_vehicle_detail' driver_id=vehicle.driver.id %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ข้อมูลรถเกี่ยว</a>

                                <a href="{% url 'view_driver_profile' driver_id=vehicle.driver.id %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">ข้อมูลเจ้าของรถ</a>
                            </div>
                        </div>
                        <!-- Product Image -->
                        <img class="w-full h-64 object-contain rounded-xl" src="{{ vehicle.image.url }}" alt="Kubota Tractor">
                        <!-- Product Details -->
                        <div class="mt-1 p-2">
                            <h3 class="text-gray-600">รุ่น : {{ vehicle.model }}</h3>
                            <p class="text-gray-600">ประเภท : {{ vehicle.type }}</p>
                            <p class="text-gray-600 ">ราคา : {{ vehicle.price }}</p>
                            <p class="text-gray-600 ">ขั้นต่ำที่รับเกี่ยว : {{ vehicle.min_acres }} ไร่</p>
                            <!-- <p class="text-gray-600 ">จำนวนไร่ที่เกี่ยวได้ต่อวัน : {{ vehicle.max_acres_per_day }} ไร่</p>
                            <p class="text-gray-600 mb-4">จังหวัด : {{ vehicle.province }}</p> -->
                            <!-- Booking Buttons -->
                            <div class="flex justify-center space-x-16 items-center mt-3">
                                <a href="{% url 'get_schedule' driver_id=vehicle.driver.id %}" class="w-28 h-10 bg-blue-500 text-white text-xs font-bold uppercase rounded flex justify-center items-center hover:transform hover:scale-110 duration-300">ตารางการจอง</a>
                                <a href="{% url 'create_booking' vehicle_id=vehicle.id %}" class="w-28 h-10 bg-green-500 text-white text-xs font-bold uppercase rounded flex justify-center items-center hover:transform hover:scale-110 duration-300">จองทันที</a>
                            </div>
                        </div>
                    </div>
                </article>
            {% endfor %}
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const typeSackCheckbox = document.getElementById('type_sack');
        const typeTankCheckbox = document.getElementById('type_tank');
        const provinceSelect = document.getElementById('province_select');

        typeSackCheckbox.addEventListener('change', filterVehicles);
        typeTankCheckbox.addEventListener('change', filterVehicles);
        provinceSelect.addEventListener('change', filterVehicles);

        function filterVehicles() {
            const typeSackChecked = typeSackCheckbox.checked;
            const typeTankChecked = typeTankCheckbox.checked;
            const selectedProvince = provinceSelect.value;

            const vehicles = document.querySelectorAll('article');
            vehicles.forEach(vehicle => {
                const type = vehicle.querySelector('p:nth-child(2)').innerText.includes('แบบรองกระสอบ') ? 'แบบรองกระสอบ' : 'แบบถังอุ้ม';
                const province = vehicle.getAttribute('data-province');

                let typeMatch = (typeSackChecked && type === 'แบบรองกระสอบ') || (typeTankChecked && type === 'แบบถังอุ้ม');
                if (!typeSackChecked && !typeTankChecked) {
                    typeMatch = true; // Show all if none selected
                }

                const provinceMatch = !selectedProvince || province === selectedProvince;

                if (typeMatch && provinceMatch) {
                    vehicle.style.display = 'block';
                } else {
                    vehicle.style.display = 'none';
                }
            });
        }

        function toggleDropdown(vehicleId) {
            // ปิด dropdown ทั้งหมดที่ไม่ใช่ dropdown ที่ถูกกด
            const allDropdowns = document.querySelectorAll('[id^="dropdownMenu"]');
            allDropdowns.forEach(dropdown => {
                if (dropdown.id !== 'dropdownMenu' + vehicleId) {
                    dropdown.classList.add('hidden');
                }
            });

            // เปิดหรือปิด dropdown ที่ถูกกด
            const dropdownMenu = document.getElementById("dropdownMenu" + vehicleId);
            dropdownMenu.classList.toggle("hidden");
        }

        window.toggleDropdown = toggleDropdown;
    });
</script>

{% endblock %}
<!-- calendar.html -->
{% extends "base.html" %}
{% load static %}

{% block content %}
<body style="font-family: 'K2D', sans-serif;">
    <div class="max-w-sm mx-auto mt-24">
        <div class="text-xl text-center font-extrabold mt-5 mb-5 bg-green-200 p-3 rounded-md border border-1 border-gray-400 shadow-lg">
            <i class="fa-solid fa-calendar-days"></i>&nbsp;&nbsp; ตารางรถเกี่ยว
        </div>
    </div>

    <div id="calendar" class="max-w-screen-md mx-auto p-4 bg-white mt-2 mb-10 rounded-lg shadow-md border border-gray-500 border-2">
    </div>

    <div class="max-w-screen-md mx-auto p-4 bg-white mt-2 mb-10 rounded-lg shadow-md border border-gray-500 border-2">
        <!-- Add Event Button -->
        <button id="add-event-button" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            เพิ่มงาน
        </button>

        <!-- Add Event Form (Initially Hidden) -->
        <div id="add-event-form" class="mt-4 hidden">
            <form id="new-event-form">
                <div class="mb-4">
                    <label for="title" class="block text-gray-700 font-bold mb-2">ชื่อเรื่อง:</label>
                    <input type="text" id="title" name="title" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="mb-4">
                    <label for="start" class="block text-gray-700 font-bold mb-2">เริ่ม:</label>
                    <input type="datetime-local" id="start" name="start" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <div class="mb-4">
                    <label for="end" class="block text-gray-700 font-bold mb-2">สิ้นสุด:</label>
                    <input type="datetime-local" id="end" name="end" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                </div>
                <button type="submit" class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                    บันทึกงาน
                </button>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            moment.locale('th');
            $('#calendar').fullCalendar({
                events: '/calendar-events/',
                locale: 'th',
                eventRender: function (event, element) {
                    var eventHtml = '<div class="flex items-center bg-green-600 border-2 border-green-800">';
                    if (event.image) {
                        eventHtml += '<div class="items-center">';
                        eventHtml += '<a href="/pets/' + event.id + '">';
                        eventHtml += '<img src="' + event.image + '" class="object-cover mx-auto w-auto">';
                        eventHtml += '</a>';
                        eventHtml += '<div class="font-bold mt-2 text-center">' + event.title + '</div>';
                        eventHtml += '<div class="text-sm text-center">' + moment(event.start).format('LT') + '</div>';
                        eventHtml += '</div></div>';
                        element.find('.fc-content').html(eventHtml);
                    }
                }
            });

            // Show/Hide Add Event Form
            document.getElementById('add-event-button').addEventListener('click', function() {
                var form = document.getElementById('add-event-form');
                if (form.classList.contains('hidden')) {
                    form.classList.remove('hidden');
                } else {
                    form.classList.add('hidden');
                }
            });

            // Handle Form Submission
            document.getElementById('new-event-form').addEventListener('submit', function(e) {
                e.preventDefault();

                var title = document.getElementById('title').value;
                var start = document.getElementById('start').value;
                var end = document.getElementById('end').value;

                fetch("{% url 'add_event' %}", {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: JSON.stringify({ title: title, start: start, end: end })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        $('#calendar').fullCalendar('refetchEvents');
                        document.getElementById('new-event-form').reset();
                        document.getElementById('add-event-form').classList.add('hidden');
                    } else {
                        alert('Error adding event');
                    }
                });
            });
        });
    </script>
{% endblock %}


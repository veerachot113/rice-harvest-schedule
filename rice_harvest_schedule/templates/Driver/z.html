<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Service Areas</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body style="font-family: 'K2D', sans-serif;">
    <div class="max-w-sm mx-auto">
        <div class="text-xl text-center font-extrabold mt-5 mb-5 bg-green-200 p-3 rounded-md border border-1 border-gray-400 shadow-lg">
            <i class="fa-solid fa-map-marker-alt"></i>&nbsp;&nbsp; พื้นที่ลงเก็บเกี่ยว
        </div>
    </div>

    <div class="max-w-screen-md mx-auto p-4 bg-white mt-5 mb-10 rounded-lg shadow-md border border-gray-500 border-2">
        <h2 class="text-xl font-bold mb-4">เพิ่มข้อมูลพื้นที่</h2>
        <form id="service-area-form">
            <div class="mb-4">
                <label class="block mb-2 text-sm font-medium text-gray-700">วันเริ่มต้น :</label>
                <input type="date" id="start-date" name="start-date" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300" required />
            </div>
            <div class="mb-4">
                <label class="block mb-2 text-sm font-medium text-gray-700">วันสิ้นสุด :</label>
                <input type="date" id="end-date" name="end-date" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300" required />
            </div>
            <div class="mb-4">
                <label class="block mb-2 text-sm font-medium text-gray-700">จังหวัด :</label>
                <select id="province" name="province" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300" required>
                    <option value="">เลือกจังหวัด</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="block mb-2 text-sm font-medium text-gray-700">อำเภอ :</label>
                <select id="district" name="district" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300" required disabled>
                    <option value="">เลือกอำเภอ</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="block mb-2 text-sm font-medium text-gray-700">ตำบล :</label>
                <div id="subdistrict" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300" required disabled>
                    <!-- Checkboxes for subdistricts will be added here -->
                </div>
            </div>
            <div class="flex justify-between">
                <button type="button" id="cancel-button" class="px-4 py-2 font-bold text-white bg-red-500 rounded-md hover:bg-red-700 focus:outline-none focus:ring focus:border-red-300">ยกเลิก</button>
                <button type="submit" class="px-4 py-2 font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700 focus:outline-none focus:ring focus:border-blue-300">เพิ่มข้อมูล</button>
            </div>
        </form>
    </div>

    <div class="max-w-screen-md mx-auto p-4 bg-white mt-5 mb-10 rounded-lg shadow-md border border-gray-500 border-2">
        <h2 class="text-xl font-bold mb-4">พื้นที่ลงเก็บเกี่ยว</h2>
        <table class="min-w-full divide-y divide-gray-200">
            <thead>
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วัน เดือน</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานที่</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                </tr>
            </thead>
            <tbody id="service-areas-list" class="bg-white divide-y divide-gray-200">
                <!-- Rows will be added dynamically here -->
            </tbody>
        </table>
    </div>

    <script type="text/javascript">
        $(document).ready(function(){
            let provinces, districts, subdistricts;

            // Load JSON data
            $.when(
                $.getJSON('https://raw.githubusercontent.com/thailand-geography-data/thailand-geography-json/main/src/provinces.json', function(data) { provinces = data; }),
                $.getJSON('https://raw.githubusercontent.com/thailand-geography-data/thailand-geography-json/main/src/districts.json', function(data) { districts = data; }),
                $.getJSON('https://raw.githubusercontent.com/thailand-geography-data/thailand-geography-json/main/src/subdistricts.json', function(data) { subdistricts = data; })
            ).then(function() {
                // ตรวจสอบข้อมูลที่ดึงมา
                console.log(provinces);
                console.log(districts);
                console.log(subdistricts);

                // Populate province select box
                let provinceSelect = $('#province');
                provinces.forEach(function(province) {
                    provinceSelect.append(new Option(province.provinceNameTh, province.provinceCode));
                });

                // On province change
                $('#province').change(function() {
                    let provinceId = $(this).val();
                    if (provinceId) {
                        let filteredDistricts = districts.filter(d => d.provinceCode == provinceId);
                        let districtSelect = $('#district');
                        districtSelect.empty().append(new Option('เลือกอำเภอ', ''));
                        filteredDistricts.forEach(function(district) {
                            districtSelect.append(new Option(district.districtNameTh, district.districtCode));
                        });
                        $('#district').prop('disabled', false);
                        $('#subdistrict').empty().prop('disabled', true);
                    } else {
                        $('#district').empty().append(new Option('เลือกอำเภอ', '')).prop('disabled', true);
                        $('#subdistrict').empty().prop('disabled', true);
                    }
                });

                // On district change
                $('#district').change(function() {
                    let districtId = $(this).val();
                    if (districtId) {
                        let filteredSubdistricts = subdistricts.filter(s => s.districtCode == districtId);
                        let subdistrictDiv = $('#subdistrict');
                        subdistrictDiv.empty();
                        filteredSubdistricts.forEach(function(subdistrict) {
                            subdistrictDiv.append(`
                                <div class="flex items-center">
                                    <input type="checkbox" id="subdistrict-${subdistrict.subdistrictCode}" name="subdistrict" value="${subdistrict.subdistrictCode}" class="mr-2">
                                    <label for="subdistrict-${subdistrict.subdistrictCode}">${subdistrict.subdistrictNameTh}</label>
                                </div>
                            `);
                        });
                        $('#subdistrict').prop('disabled', false);
                    } else {
                        $('#subdistrict').empty().prop('disabled', true);
                    }
                });
            });

            const form = document.getElementById('service-area-form');
            const serviceAreasList = document.getElementById('service-areas-list');
            const cancelButton = document.getElementById('cancel-button');

            form.addEventListener('submit', function(event) {
                event.preventDefault();
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                const province = document.getElementById('province').value;
                const district = document.getElementById('district').value;
                const subdistricts = Array.from(document.querySelectorAll('input[name="subdistrict"]:checked')).map(checkbox => checkbox.nextSibling.textContent.trim()).join(', ');

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${startDate} - ${endDate}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">จังหวัด ${province} อำเภอ ${district} ตำบล ${subdistricts}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button class="text-indigo-600 hover:text-indigo-900">แก้ไข</button>
                        <button class="text-red-600 hover:text-red-900">ลบ</button>
                    </td>
                `;

                serviceAreasList.appendChild(row);
                form.reset();
                $('#district').empty().append(new Option('เลือกอำเภอ', '')).prop('disabled', true);
                $('#subdistrict').empty().prop('disabled', true);
            });

            cancelButton.addEventListener('click', function() {
                form.reset();
                $('#district').empty().append(new Option('เลือกอำเภอ', '')).prop('disabled', true);
                $('#subdistrict').empty().prop('disabled', true);
            });
        });
    </script>
</body>
</html>

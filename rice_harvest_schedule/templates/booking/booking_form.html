{% extends "base.html" %}
{% load static %}
{% block title %}
Create Booking - Farmer
{% endblock %}
{% block main %}
<div class="container mx-auto p-2 mt-36">
    <div class="flex flex-col max-w-7xl mx-auto bg-white border border-gray-300 rounded-lg shadow-lg">
        <h1 class="text-4xl text-center mb-8 mt-7">กรอกรายละเอียดการจอง</h1>
        <div class="w-full md:flex">
            <div class="md:w-1/2 p-6">
                <img class="mx-auto md:justify-center object-cover md:w-3/4 h-auto rounded-xl overflow-hidden"
                    src="{{ vehicle.image.url }}" alt="Vehicle">
                <div class="mx-auto md:justify-center object-cover md:w-3/4 h-auto mt-10 rounded-xl overflow-hidden">
                    <div class="mb-3 grid grid-cols-2 mr-24">
                        <label for="name" class="form-label">ชื่อคนขับ:</label>
                        <span class="col span-1"> {{ vehicle.driver.first_name }} {{ vehicle.driver.last_name }}</span>
                    </div>
                    <div class="mb-3 grid grid-cols-2 mr-24">
                        <label for="quantity" class="form-label">ประเภทรถ: </label>
                        <span class="col span-1">{{ vehicle.type }}</span>
                    </div>
                    <div class="mb-3 grid grid-cols-2 mr-24">
                        <label for="phone" class="form-label">ราคาต่อไร่: </label>
                        <span class="col span-1 ">{{ vehicle.price }} บาท</span>
                    </div>
                    <div class="mb-3 grid grid-cols-2 mr-24">
                        <label for="phone" class="form-label">จังหวัด: </label>
                        <span class="col span-1 mr-3">{{ vehicle.province }}</span>
                    </div>
                </div>
            </div>
            <div class="md:w-1/2 p-4">
                <form method="post" action="">
                    {% csrf_token %}
                    <div class="mb-4">
                        <label for="name" class="block text-sm font-medium text-gray-700">ชื่อ-สกุล:</label>
                        <input type="text" id="name" name="fullname"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-100 focus:border-indigo-500 sm:text-xl">
                    </div>
                    <div class="mb-4">
                        <label for="address" class="block text-sm font-medium text-gray-700">ที่อยู่:</label>
                        <textarea id="address" name="address" rows="4"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="quantity" class="block text-sm font-medium text-gray-700">จำนวนไร่:</label>
                        <input type="number" id="quantity" name="quantity"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-xl">
                    </div>
                    <div class="mb-4">
                        <label for="appointment_start_date" class="block text-sm font-medium text-gray-700">วันเริ่มต้น:</label>
                        <input type="date" id="appointment_start_date" name="appointment_start_date"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-xl">
                    </div>
                    <div class="mb-4">
                        <label for="appointment_end_date_display" class="block text-sm font-medium text-gray-700">วันสิ้นสุด:</label>
                        <input type="text" id="appointment_end_date_display" name="appointment_end_date_display"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-xl" disabled>
                        <input type="hidden" id="appointment_end_date" name="appointment_end_date">
                    </div>
                    <div class="mb-4">
                        <label for="phone" class="block text-sm font-medium text-gray-700">เบอร์ติดต่อ:</label>
                        <input type="text" id="phone" name="phone"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-xl">
                    </div>
                    <div class="mb-4">
                        <label for="details" class="block text-sm font-medium text-gray-700">รายละเอียด:</label>
                        <textarea id="details" name="details" rows="4"
                            class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                    </div>
                    <button type="submit"
                        class="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">เพิ่ม</button>
                </form>
                
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const quantityInput = document.getElementById('quantity');
        const startDateInput = document.getElementById('appointment_start_date');
        const endDateDisplay = document.getElementById('appointment_end_date_display');
        const endDateInput = document.getElementById('appointment_end_date');

        function calculateEndDate() {
            const quantity = parseInt(quantityInput.value, 10);
            const startDate = new Date(startDateInput.value);

            if (!isNaN(quantity) && startDate instanceof Date && !isNaN(startDate.getTime())) {
                let daysRequired = 1;
                if (quantity > 30) {
                    daysRequired = Math.ceil(quantity / 25);
                }

                const endDate = new Date(startDate);
                endDate.setDate(endDate.getDate() + daysRequired - 1);

                const formattedEndDate = endDate.toISOString().slice(0, 10);
                endDateDisplay.value = formattedEndDate;
                endDateInput.value = formattedEndDate;
            } else {
                endDateDisplay.value = '';
                endDateInput.value = '';
            }
        }

        quantityInput.addEventListener('input', calculateEndDate);
        startDateInput.addEventListener('input', calculateEndDate);
    });
</script>

{% endblock %}

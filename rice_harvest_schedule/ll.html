<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver Service Areas</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body style="font-family: 'K2D', sans-serif;">
    <div class="max-w-sm mx-auto">
        <div class="text-xl text-center font-extrabold mt-5 mb-5 bg-green-200 p-3 rounded-md border border-1 border-gray-400 shadow-lg">
            <i class="fa-solid fa-map-marker-alt"></i>&nbsp;&nbsp; พื้นที่ลงเก็บเกี่ยว
        </div>
    </div>

    <div class="max-w-screen-md mx-auto p-4 bg-white mt-5 mb-10 rounded-lg shadow-md border border-gray-500 border-2">
        <h2 class="text-xl font-bold mb-4">เพิ่มข้อมูลพื้นที่</h2>
        <form id="service-area-form">
            <div class="mb-4">
                <label class="block mb-2 text-sm font-medium text-gray-700">วันเริ่มต้น :</label>
                <input type="date" id="start-date" name="start-date" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300" required />
            </div>
            <div class="mb-4">
                <label class="block mb-2 text-sm font-medium text-gray-700">วันสิ้นสุด :</label>
                <input type="date" id="end-date" name="end-date" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300" required />
            </div>
            <div class="mb-4">
                <label for="province" class="block mb-2 text-sm font-medium text-gray-700">จังหวัด :</label>
                <select id="province" name="province" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300" required>
                    <option value="">เลือกจังหวัด</option>
                    <!-- Provinces will be populated dynamically -->
                </select>
            </div>
            <div class="mb-4">
                <label class="block mb-2 text-sm font-medium text-gray-700">อำเภอ :</label>
                <select id="district" name="district" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300" required>
                    <option value="">เลือกอำเภอ</option>
                    <!-- Districts will be populated dynamically -->
                </select>
            </div>
            <div class="mb-4">
                <label class="block mb-2 text-sm font-medium text-gray-700">ตำบล :</label>
                <select id="subdistrict" name="subdistrict" class="w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300" required>
                    <option value="">เลือกตำบล</option>
                    <!-- Subdistricts will be populated dynamically -->
                </select>
            </div>
            <div class="flex justify-between">
                <button type="button" id="cancel-button" class="px-4 py-2 font-bold text-white bg-red-500 rounded-md hover:bg-red-700 focus:outline-none focus:ring focus:border-red-300">ยกเลิก</button>
                <button type="submit" class="px-4 py-2 font-bold text-white bg-blue-500 rounded-md hover:bg-blue-700 focus:outline-none focus:ring focus:border-blue-300">เพิ่มข้อมูล</button>
            </div>
        </form>
    </div>

    <div class="max-w-screen-md mx-auto p-4 bg-white mt-5 mb-10 rounded-lg shadow-md border border-gray-500 border-2">
        <h2 class="text-xl font-bold mb-4">พื้นที่ลงเก็บเกี่ยว</h2>
        <table class="min-w-full divide-y divide-gray-200">
            <thead>
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">วัน เดือน</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">สถานที่</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">การจัดการ</th>
                </tr>
            </thead>
            <tbody id="service-areas-list" class="bg-white divide-y divide-gray-200">
                <!-- Rows will be added dynamically here -->
            </tbody>
        </table>
    </div>

    <script type="text/javascript">
        $(document).ready(function(){
            let provinces, districts, subdistricts;

            // Load JSON data
            $.when(
                $.getJSON('https://raw.githubusercontent.com/thailand-geography-data/thailand-geography-json/main/src/provinces.json', function(data) { provinces = data; }),
                $.getJSON('https://raw.githubusercontent.com/thailand-geography-data/thailand-geography-json/main/src/districts.json', function(data) { districts = data; }),
                $.getJSON('https://raw.githubusercontent.com/thailand-geography-data/thailand-geography-json/main/src/subdistricts.json', function(data) { subdistricts = data; })
            ).then(function() {
                // ตรวจสอบข้อมูลที่ดึงมา
                console.log(provinces);
                console.log(districts);
                console.log(subdistricts);

                // Populate province select box
                let provinceSelect = $('#province');
                provinces.forEach(function(province) {
                    provinceSelect.append(new Option(province.provinceNameTh, province.provinceCode));
                });

                // On province change
                $('#province').change(function() {
                    let provinceId = $(this).val();
                    if (provinceId) {
                        let filteredDistricts = districts.filter(d => d.provinceCode == provinceId);
                        let districtSelect = $('#district');
                        districtSelect.empty().append(new Option('เลือกอำเภอ', ''));
                        filteredDistricts.forEach(function(district) {
                            districtSelect.append(new Option(district.districtNameTh, district.districtCode));
                        });
                        $('#district').prop('disabled', false);
                    } else {
                        $('#district').empty().append(new Option('เลือกอำเภอ', '')).prop('disabled', true);
                        $('#subdistrict').empty().append(new Option('เลือกตำบล', '')).prop('disabled', true);
                    }
                });

                // On district change
                $('#district').change(function() {
                    let districtId = $(this).val();
                    if (districtId) {
                        let filteredSubdistricts = subdistricts.filter(s => s.districtCode == districtId);
                        let subdistrictSelect = $('#subdistrict');
                        subdistrictSelect.empty().append(new Option('เลือกตำบล', ''));
                        filteredSubdistricts.forEach(function(subdistrict) {
                            subdistrictSelect.append(new Option(subdistrict.subdistrictNameTh, subdistrict.subdistrictCode));
                        });
                        $('#subdistrict').prop('disabled', false);
                    } else {
                        $('#subdistrict').empty().append(new Option('เลือกตำบล', '')).prop('disabled', true);
                    }
                });
            });

            $('#service-area-form').submit(function(event) {
                event.preventDefault();

                // Collect form data
                let startDate = $('#start-date').val();
                let endDate = $('#end-date').val();
                let province = $('#province option:selected').text();
                let district = $('#district option:selected').text();
                let subdistrict = $('#subdistrict option:selected').text();

                // Add new row to the table
                let newRow = `
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${startDate} - ${endDate}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${province}, ${district}, ${subdistrict}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            <button class="text-red-600 hover:text-red-900 delete-button">ลบ</button>
                        </td>
                    </tr>
                `;
                $('#service-areas-list').append(newRow);

                // Clear form fields
                $('#service-area-form')[0].reset();
                $('#district').empty().append(new Option('เลือกอำเภอ', '')).prop('disabled', true);
                $('#subdistrict').empty().append(new Option('เลือกตำบล', '')).prop('disabled', true);
            });

            // Delete row
            $('#service-areas-list').on('click', '.delete-button', function() {
                $(this).closest('tr').remove();
            });

            // Cancel button action
            $('#cancel-button').click(function() {
                $('#service-area-form')[0].reset();
                $('#district').empty().append(new Option('เลือกอำเภอ', '')).prop('disabled', true);
                $('#subdistrict').empty().append(new Option('เลือกตำบล', '')).prop('disabled', true);
            });
        });
    </script>
</body>
</html>
